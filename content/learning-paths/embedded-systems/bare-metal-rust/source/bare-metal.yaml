# Copyright (c) 2024, Arm Limited.
# SPDX-License-Identifier: MIT

%YAML 1.2
---
description: >-
  Run a bare-metal binary from TrustedFirmware-A.

concrete: true

layers:
  - FVP_Base_RevC-2xAEMvA-base.yaml
  - tfa-base.yaml
  - dt-base.yaml
  - arch/v9.2.yaml

build:
  tfa:
    params:
      ARM_LINUX_KERNEL_AS_BL33: 1
      PRELOADED_BL33_BASE: 0x84000000
      ARM_PRELOADED_DTB_BASE: 0x82000000
      FVP_HW_CONFIG: ${artifact:DTB}
      LOG_LEVEL: LOG_LEVEL_NOTICE

run:
  rtvars:
    BINARY:
      type: path
      value: null

    BL1:
      type: path
      value: ${artifact:BL1}

    DTB:
      type: path
      value: ${artifact:DTB}

    FIP:
      type: path
      value: ${artifact:FIP}

  params:
    -C bp.secureflashloader.fname: ${rtvar:BL1}
    -C bp.flashloader0.fname: ${rtvar:FIP}
    -C bp.secure_memory: 0
    '--data cluster0.cpu0': ${rtvar:DTB}@0x82000000
    ' --data cluster0.cpu0': ${rtvar:BINARY}@0x84000000

  terminals:
    bp.terminal_0:
      friendly: ''
      type: stdinout
      no_color: true
